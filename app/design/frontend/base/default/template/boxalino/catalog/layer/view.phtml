<?php if($this->canShowBlock()): ?>
    <div class="block block-layered-nav">
        <div class="block-title">
            <strong><span><?php echo $this->__('Shop By') ?></span></strong>
        </div>
        <div class="block-content">
            <?php echo $this->getStateHtml() ?>
            <?php if ($this->getChild('layer_state')->getActiveFilters()): ?>
                <div class="actions"><a href="<?php echo $this->getClearUrl() ?>"><?php echo $this->__('Clear All') ?></a></div>
            <?php endif; ?>
            <?php if($this->canShowOptions()): ?>
                <p class="block-subtitle"><?php echo $this->__('Shopping Options') ?></p>
                <dl id="narrow-by-list">
                    <?php
                    $bxFacets = $this->bxFacets;
                    $filters = $this->getFilters();
                    ?>
                    <?php foreach ($filters as $_filter): ?>
                        <?php
                             $isExpanded = (bool) $bxFacets->isFacetExpanded($_filter->getFieldName(), false);
                             $isHidden = (bool) $bxFacets->isFacetHidden($_filter->getFieldName());
                             $label = $bxFacets->getFacetLabel($_filter->getFieldName());
                         ?>
                        <?php if($_filter->getItemsCount() && !$isHidden): ?>
                            <dt>
                                <?php echo (!empty($label) || !is_null($label)) ? $label : $this->__($_filter->getName()) ?>
                            </dt>
                            <dd><?php echo $_filter->getHtml() ?></dd>
                        <?php endif; ?>
                    <?php endforeach; ?>
                </dl>
                <script type="text/javascript">decorateDataList('narrow-by-list');</script>
            <?php endif; ?>
        </div>
    </div>
<?php endif; ?>